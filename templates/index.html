<!DOCTYPE html>
<html>
<head>
    <title>ChunkMaster | Divide & Aprenda</title>
    {% load static %}
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/index.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
    <div class="container">
        <div class="app-header animate__animated animate__fadeIn">
            <h1>Chunk<span class="highlight">Master</span></h1>
            <p>Transforme temas complexos em <span class="chunk-text">chunks</span> digestíveis para facilitar seu aprendizado</p>
        </div>

        <div class="form-container animate__animated animate__fadeInUp">
            <form method="post">
                {% csrf_token %}
                <div class="row">
                    <div class="col-md-8 mb-3">
                        <label>O que você quer <span class="chunk-text">chunkar</span> hoje?</label>
                        <input type="text" name="tema" class="form-control" value="{{ tema }}" required placeholder="Ex: Física Quântica, Literatura Brasileira, Machine Learning...">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label>Número de <span class="chunk-text">chunks</span>:</label>
                        <input type="number" name="num_partes" class="form-control" value="{{ num_partes }}" min="2" max="22" required>
                        <small class="text-muted">Mínimo: 2, Máximo: 22</small>
                        <div id="parts-warning" style="display:none;" class="text-danger mt-1">
                            <strong>Nota:</strong> Muitos chunks podem levar mais tempo para gerar.
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn chunk-button" {% if quota_exceeded %}disabled title="API indisponível no momento"{% endif %}>
                    <span class="chunk-icon">⧉</span> Chunk!
                </button>
            </form>
        </div>
        
        {% if error %}
        <div class="alert alert-danger">
            <h4 class="alert-heading">Erro:</h4>
            <p>{{ error }}</p>
            {% if quota_exceeded %}
            <hr>
            <div class="quota-info">
                <h5 style="color: #ff6f00;">O que isso significa?</h5>
                <p>A API do Google Gemini tem limites de uso gratuito:</p>
                <ul>
                    <li>60 solicitações por minuto</li>
                    <li>Número limitado de solicitações por dia</li>
                </ul>
                <p>Opções para resolver:</p>
                <ol>
                    <li>Aguardar alguns minutos e tentar novamente</li>
                    <li>Obter uma nova chave de API em <a href="https://ai.google.dev/" target="_blank">Google AI Studio</a></li>
                    <li>Atualizar para um plano pago no Google Cloud</li>
                </ol>
            </div>
            {% endif %}
        </div>
        {% endif %}
        
        {% if html_result %}
        <div class="result-container">
            <!-- Índice de navegação -->
            <div class="toc card mb-4" id="table-of-contents">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div class="toc-title">Navegue pelos <span class="chunk-text">chunks</span></div>
                    <button class="btn btn-sm btn-outline-secondary toc-toggle" onclick="toggleToc()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots" viewBox="0 0 16 16">
                            <path d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"/>
                        </svg>
                        <span id="toc-toggle-text">Ocultar</span>
                    </button>
                </div>
                <div class="card-body toc-container">
                    <!-- Será preenchido via JavaScript -->
                </div>
            </div>
            
            <!-- Conteúdo HTML que será processado pelo JS -->
            <div id="html-content" style="display:none">{{ html_result|safe }}</div>
            
            <!-- Bootstrap Grid para Cards -->
            <div class="masonry-grid" id="cards-container">
                <!-- Os cards serão gerados via JavaScript -->
            </div>
            
            <!-- Fallback content container -->
            <div id="fallback-content" class="fallback-content card">
                <div class="card-header">
                    <h3>Seu conteúdo <span class="chunk-text">chunkado</span>:</h3>
                </div>
                <div class="card-body formatted-content-visible">
                    {{ html_result|safe }}
                </div>
                <div class="card-footer">
                    <button class="btn btn-outline-secondary expand-button" onclick="toggleFallbackContent()">Expandir/Recolher</button>
                </div>
            </div>
        </div>
        {% endif %}
        
        <footer class="site-footer">
            <p>© 2024 ChunkMaster | Simplificando o aprendizado através de chunks inteligentes</p>
        </footer>
    </div>
    
    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Opcional: Masonry para layout de grade dinâmica -->
    <script src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js"></script>
    
    <!-- Inclusão do arquivo JavaScript externo -->
    {% if html_result %}
    <script src="{% static 'js/index.js' %}"></script>
    {% endif %}
</body>
</html>
